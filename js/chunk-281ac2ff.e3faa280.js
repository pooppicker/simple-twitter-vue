(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-281ac2ff"],{"065e":function(s,t,e){},da23:function(s,t,e){"use strict";e("065e")},ffce:function(s,t,e){"use strict";e.r(t);var a=function(){var s=this,t=s._self._c;return t("div",{staticClass:"container public-message-content"},[t("div",{staticClass:"public-message"},[t("div",{staticClass:"navbars"},[t("NavBars")],1),t("div",{staticClass:"public-users"},[t("div",{staticClass:"public-users-title"},[t("h2",[s._v("上線使用者("+s._s(s.usersCount)+")")])]),t("div",{staticClass:"public-users-content"},s._l(s.users,(function(e){return t("div",{key:e.id},[t("div",{staticClass:"public-users-content-card"},[t("router-link",{attrs:{to:{name:"User",params:{id:e.id}}}},[t("img",{staticClass:"public-users-content-img",attrs:{src:e.avatar}})]),t("div",{staticClass:"public-users-content-text"},[t("router-link",{attrs:{to:{name:"User",params:{id:e.id}}}},[t("div",{staticClass:"public-users-content-text-name"},[s._v(" "+s._s(e.name)+" ")])]),t("div",{staticClass:"public-users-content-text-account"},[s._v(" @"+s._s(e.account)+" ")])],1)],1)])})),0)]),t("div",{staticClass:"public-messages"},[t("Message",{attrs:{roomId:s.roomId,initialMessage:s.Messages}})],1)])])},i=[],o=(e("14d9"),e("0baf")),c=e("0f7d"),r=e("daa8"),n=e("d826"),u=e("ec26"),d={name:"Public-message",components:{NavBars:o["a"],Message:c["a"]},data(){return{socket:[],users:[],usersCount:0,roomId:1,Messages:[]}},methods:{createdSocket(){const s=localStorage.getItem("token");this.socket=Object(r["a"])("https://twitter-apis-demo.herokuapp.com",{auth:{token:s}})},enterMessage(){this.socket.emit("join",{roomId:1})},NoticeUser(){this.socket.on("active users",s=>{this.usersCount=s.userCount,this.users=s.activeUsers})},getMessage(){this.socket.on("public chat",s=>{const t={...s,uuId:Object(u["a"])()};this.Messages.push(t),this.messageBottom=!1})},message(){this.socket.on("message",s=>{this.Messages.push(s),this.messageBottom=!0})},leaveRoom(){1===this.roomId&&this.socket.emit("leave",{roomId:this.roomId})},async fetchMessage(){try{const s=await n["a"].getMessage({roomId:this.roomId});this.Messages=s.data.map(s=>({userId:s.User.id,type:"message",avatar:s.User.avatar,createdAt:s.createdAt,uuId:Object(u["a"])(),text:{content:s.content}})),this.Messages.push(s.data),this.messageBottom=!1}catch(s){console.log(s)}}},created(){this.createdSocket(),this.enterMessage()},mounted(){this.fetchMessage(),this.getMessage(),this.message(),this.NoticeUser()},beforeDestroy(){this.leaveRoom()}},l=d,m=(e("da23"),e("2877")),h=Object(m["a"])(l,a,i,!1,null,"717b4b3d",null);t["default"]=h.exports}}]);
//# sourceMappingURL=chunk-281ac2ff.e3faa280.js.map