(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-81ab0d44"],{7885:function(t,e,s){"use strict";s("b363")},b363:function(t,e,s){},e39f:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container public-message-content"},[e("div",{staticClass:"public-message"},[e("div",{staticClass:"navbars"},[e("NavBars")],1),e("div",{staticClass:"public-users"},[e("div",{staticClass:"public-users-title"},[e("h2",[t._v("訊息")]),e("IconAddMessage")],1),e("div",{staticClass:"public-users-content"},t._l(t.users,(function(s){return e("div",{key:s.uuId},[e("div",{class:["public-users-content-card",{active:s.userId===t.otherUser.id}]},[e("router-link",{attrs:{to:{name:"Private-message",params:{id:s.userId}}}},[e("img",{staticClass:"public-users-content-img",attrs:{src:s.avatar}})]),e("div",{staticStyle:{width:"100%"}},[e("div",{staticClass:"public-users-content-text"},[e("div",{staticClass:"public-users-content-detail d-flex"},[e("router-link",{attrs:{to:{name:"Private-message",params:{id:s.userId}}}},[e("div",{staticClass:"public-users-content-text-name"},[t._v(" "+t._s(s.name)+" ")])]),e("div",{staticClass:"public-users-content-text-account"},[t._v(" @"+t._s(s.account)+" ")])],1),e("div",{staticClass:"public-users-content-text-time"},[t._v(" "+t._s(t._f("fromNow")(s.createdAt))+" ")])]),e("router-link",{attrs:{to:{name:"Private-message",params:{id:s.userId}}}},[e("div",{staticClass:"public-users-content-text-message"},[t._v(" "+t._s(s.content)+" ")])])],1)],1)])})),0)]),e("div",{staticClass:"public-messages"},[e("Message",{attrs:{roomId:t.roomId,initialMessage:t.Messages,otherUser:t.otherUser}})],1)])])},r=[],i=(s("14d9"),s("0baf")),c=s("0f7d"),o=s("daa8"),n=s("4cce"),d=s("2f62"),u=s("d826"),h=function(){var t=this,e=t._self._c;return e("svg",{attrs:{width:"23",height:"22",viewBox:"0 0 23 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[e("path",{attrs:{d:"M22.2499 3.25001H19.8249V0.825012C19.8249 0.411012 19.4889 0.0750122 19.0749 0.0750122C18.6609 0.0750122 18.3249 0.411012 18.3249 0.825012V3.25001H15.8999C15.4859 3.25001 15.1499 3.58601 15.1499 4.00001C15.1499 4.41401 15.4859 4.75001 15.8999 4.75001H18.3249V7.17501C18.3249 7.58901 18.6609 7.92501 19.0749 7.92501C19.4889 7.92501 19.8249 7.58901 19.8249 7.17501V4.75001H22.2499C22.6639 4.75001 22.9999 4.41401 22.9999 4.00001C22.9999 3.58601 22.6639 3.25001 22.2499 3.25001ZM19.0749 10.126C18.6609 10.126 18.3249 10.462 18.3249 10.876V18.954C18.3249 19.368 17.9879 19.704 17.5749 19.704H3.09495C2.68295 19.704 2.34495 19.368 2.34495 18.954V8.29801L9.12295 12.816C9.49095 13.062 9.91295 13.186 10.3359 13.186C10.7579 13.186 11.1799 13.062 11.5479 12.816L16.0779 9.80301C16.4139 9.58001 16.5059 9.12701 16.2819 8.79101C16.0589 8.45901 15.6069 8.36601 15.2699 8.59101L10.7399 11.605C10.4939 11.767 10.1769 11.768 9.93195 11.605L2.34595 6.54501V5.50001C2.34595 5.08601 2.68295 4.75001 3.09595 4.75001H12.1899C12.6039 4.75001 12.9399 4.41401 12.9399 4.00001C12.9399 3.58601 12.6039 3.25001 12.1899 3.25001H3.09595C1.85595 3.25001 0.845947 4.26001 0.845947 5.50001V18.955C0.845947 20.195 1.85595 21.205 3.09595 21.205H17.5759C18.8159 21.205 19.8259 20.195 19.8259 18.955V10.877C19.8259 10.462 19.4889 10.127 19.0759 10.127L19.0749 10.126Z",fill:"black"}})])},l=[],m=s("2877"),p={},g=Object(m["a"])(p,h,l,!1,null,null,null),v=g.exports,C=s("2708"),I=s("ec26"),b={name:"Private-message",mixins:[C["b"]],components:{NavBars:i["a"],Message:c["a"],IconAddMessage:v},data(){return{socket:[],users:[],usersCount:0,roomId:"",otherUser:{},Messages:[]}},methods:{createdSocket(){const t=localStorage.getItem("token");this.socket=Object(o["a"])("https://twitter-apis-demo.herokuapp.com",{auth:{token:t}})},async createRoomId(t){try{if("home"===t)return;const e=await n["a"].getUser({userID:t});this.otherUser=e.data,this.otherUser.id<this.currentUser.id?(this.roomId=`${this.otherUser.id}0${this.currentUser.id}`,this.enterMessage(),this.fetchMessage()):(this.roomId=`${this.currentUser.id}0${this.otherUser.id}`,this.enterMessage(),this.fetchMessage())}catch(e){console.log(e)}},enterMessage(){this.socket.emit("join",{roomId:this.roomId})},async fetchMessage(){try{const t=await u["a"].getMessage({roomId:this.roomId});this.Messages=t.data.map(t=>({userId:t.User.id,type:"message",avatar:t.User.avatar,createdAt:t.createdAt,uuId:Object(I["a"])(),text:{content:t.content}})),this.Messages.push(t.data),this.messageBottom=!1}catch(t){console.log(t)}},async fetchUsers(){try{const t=await u["a"].getUsers();this.users=t.data.map(t=>({userId:t.user.id,avatar:t.user.avatar,account:t.user.account,name:t.user.name,content:t.content,createdAt:t.createdAt}))}catch(t){console.log(t)}},getMessage(){this.socket.on("private chat",t=>{const e={...t,uuId:Object(I["a"])()};e.userId!==this.currentUser.id&&e.userId!==this.otherUser.id||this.Messages.push(e),this.updateUserList(e)})},updateUserList(t){const e=[];this.users.map(t=>{e.push(t.userId)}),t.userId!==this.currentUser.id&&this.users.map(e=>{t.userId===e.userId&&(e.content=t.text.content,e.createdAt=t.createdAt)}),t.userId===this.currentUser.id&&(-1===e.indexOf(this.otherUser.id)?this.fetchUsers():this.users.map(e=>{t.text.receiverId===e.userId&&(e.content=t.text.content,e.createdAt=t.createdAt)}))}},created(){const{id:t}=this.$route.params;this.createRoomId(t),this.createdSocket(),this.fetchUsers()},mounted(){this.getMessage()},computed:{...Object(d["b"])(["currentUser"])},beforeRouteUpdate(t,e,s){if("Private-message"===t.name){const{id:e}=t.params;this.createRoomId(e),s()}else s()}},f=b,U=(s("7885"),Object(m["a"])(f,a,r,!1,null,"cc3d61c0",null));e["default"]=U.exports}}]);
//# sourceMappingURL=chunk-81ab0d44.d9de2110.js.map