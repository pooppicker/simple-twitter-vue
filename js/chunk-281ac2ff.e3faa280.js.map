{"version":3,"sources":["webpack:///./src/views/PublicMessage.vue?58e4","webpack:///./src/views/PublicMessage.vue","webpack:///src/views/PublicMessage.vue","webpack:///./src/views/PublicMessage.vue?862b","webpack:///./src/views/PublicMessage.vue?246c"],"names":["render","_vm","this","_c","_self","staticClass","_v","_s","usersCount","_l","users","user","key","id","attrs","name","params","avatar","account","roomId","Messages","staticRenderFns","components","NavBars","Message","data","socket","methods","createdSocket","auth","token","enterMessage","NoticeUser","getMessage","uuId","message","leaveRoom","userId","type","createdAt","text","content","console","created","mounted","beforeDestroy","component"],"mappings":"yIAAA,W,yCCAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,oCAAoC,CAACF,EAAG,MAAM,CAACE,YAAY,kBAAkB,CAACF,EAAG,MAAM,CAACE,YAAY,WAAW,CAACF,EAAG,YAAY,GAAGA,EAAG,MAAM,CAACE,YAAY,gBAAgB,CAACF,EAAG,MAAM,CAACE,YAAY,sBAAsB,CAACF,EAAG,KAAK,CAACF,EAAIK,GAAG,SAASL,EAAIM,GAAGN,EAAIO,YAAY,SAASL,EAAG,MAAM,CAACE,YAAY,wBAAwBJ,EAAIQ,GAAIR,EAAIS,OAAO,SAASC,GAAM,OAAOR,EAAG,MAAM,CAACS,IAAID,EAAKE,IAAI,CAACV,EAAG,MAAM,CAACE,YAAY,6BAA6B,CAACF,EAAG,cAAc,CAACW,MAAM,CAAC,GAAK,CAAEC,KAAM,OAAQC,OAAQ,CAAEH,GAAIF,EAAKE,OAAS,CAACV,EAAG,MAAM,CAACE,YAAY,2BAA2BS,MAAM,CAAC,IAAMH,EAAKM,YAAYd,EAAG,MAAM,CAACE,YAAY,6BAA6B,CAACF,EAAG,cAAc,CAACW,MAAM,CAAC,GAAK,CAAEC,KAAM,OAAQC,OAAQ,CAAEH,GAAIF,EAAKE,OAAS,CAACV,EAAG,MAAM,CAACE,YAAY,kCAAkC,CAACJ,EAAIK,GAAG,IAAIL,EAAIM,GAAGI,EAAKI,MAAM,SAASZ,EAAG,MAAM,CAACE,YAAY,qCAAqC,CAACJ,EAAIK,GAAG,KAAKL,EAAIM,GAAGI,EAAKO,SAAS,QAAQ,IAAI,QAAO,KAAKf,EAAG,MAAM,CAACE,YAAY,mBAAmB,CAACF,EAAG,UAAU,CAACW,MAAM,CAAC,OAASb,EAAIkB,OAAO,eAAiBlB,EAAImB,aAAa,QAEzmCC,EAAkB,G,wECiDP,GACfN,sBACAO,YACAC,eACAC,gBAGAC,OACA,OACAC,UACAhB,SACAF,aACAW,SACAC,cAIAO,SACAC,gBACA,sCACA,sEACAC,MAAAC,YAKAC,eACA,yBACAZ,YAKAa,aACA,kCAEA,4BACA,4BAMAC,aACA,iCAGA,YACA,EACAC,uBAEA,sBAEA,yBAKAC,UACA,6BACA,sBAEA,yBAKAC,YACA,iBACA,0BACAjB,sBAeA,qBACA,IACA,iCACAA,qBAEA,8BACAkB,iBACAC,eACArB,qBACAsB,sBACAL,sBACAM,MACAC,sBAIA,2BAEA,sBACA,SACAC,kBASAC,UACA,qBACA,qBAGAC,UAEA,oBACA,kBACA,eACA,mBAIAC,gBACA,mBCpLuV,I,wBCQnVC,EAAY,eACd,EACA9C,EACAqB,GACA,EACA,KACA,WACA,MAIa,aAAAyB,E","file":"js/chunk-281ac2ff.e3faa280.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicMessage.vue?vue&type=style&index=0&id=717b4b3d&prod&lang=scss&scoped=true&\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"container public-message-content\"},[_c('div',{staticClass:\"public-message\"},[_c('div',{staticClass:\"navbars\"},[_c('NavBars')],1),_c('div',{staticClass:\"public-users\"},[_c('div',{staticClass:\"public-users-title\"},[_c('h2',[_vm._v(\"上線使用者(\"+_vm._s(_vm.usersCount)+\")\")])]),_c('div',{staticClass:\"public-users-content\"},_vm._l((_vm.users),function(user){return _c('div',{key:user.id},[_c('div',{staticClass:\"public-users-content-card\"},[_c('router-link',{attrs:{\"to\":{ name: 'User', params: { id: user.id } }}},[_c('img',{staticClass:\"public-users-content-img\",attrs:{\"src\":user.avatar}})]),_c('div',{staticClass:\"public-users-content-text\"},[_c('router-link',{attrs:{\"to\":{ name: 'User', params: { id: user.id } }}},[_c('div',{staticClass:\"public-users-content-text-name\"},[_vm._v(\" \"+_vm._s(user.name)+\" \")])]),_c('div',{staticClass:\"public-users-content-text-account\"},[_vm._v(\" @\"+_vm._s(user.account)+\" \")])],1)],1)])}),0)]),_c('div',{staticClass:\"public-messages\"},[_c('Message',{attrs:{\"roomId\":_vm.roomId,\"initialMessage\":_vm.Messages}})],1)])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"container public-message-content\">\n    <div class=\"public-message\">\n      <div class=\"navbars\">\n        <!--navbar-->\n        <NavBars />\n      </div>\n      <!--上線使用者-->\n      <div class=\"public-users\">\n        <div class=\"public-users-title\">\n          <h2>上線使用者({{ usersCount }})</h2>\n        </div>\n        <div class=\"public-users-content\">\n          <!--底下跑v-for迴圈-->\n          <div v-for=\"user in users\" :key=\"user.id\">\n            <div class=\"public-users-content-card\">\n              <router-link :to=\"{ name: 'User', params: { id: user.id } }\">\n                <img class=\"public-users-content-img\" :src=\"user.avatar\" />\n              </router-link>\n\n              <div class=\"public-users-content-text\">\n                <router-link :to=\"{ name: 'User', params: { id: user.id } }\">\n                  <div class=\"public-users-content-text-name\">\n                    {{ user.name }}\n                  </div>\n                </router-link>\n                <div class=\"public-users-content-text-account\">\n                  @{{ user.account }}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <!--底下跑v-for迴圈結束-->\n      </div>\n      <!--公開聊天室-->\n      <div class=\"public-messages\">\n        <Message :roomId=\"roomId\" :initialMessage=\"Messages\" />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport NavBars from \"./../components/NavBars\";\nimport Message from \"./../components/Message.vue\";\nimport { io } from \"socket.io-client\";\nimport MessageAPI from \"./../apis/message\";\nimport { v4 as uuidv4 } from \"uuid\";\n//import { mapState } from \"vuex\";\n\nexport default {\n  name: \"Public-message\",\n  components: {\n    NavBars,\n    Message,\n  },\n\n  data() {\n    return {\n      socket: [],\n      users: [],\n      usersCount: 0,\n      roomId: 1,\n      Messages: [],\n    };\n  },\n\n  methods: {\n    createdSocket() {\n      const tokenInLocalStorage = localStorage.getItem(\"token\");\n      this.socket = io(\"https://twitter-apis-demo.herokuapp.com\", {\n        auth: { token: tokenInLocalStorage },\n      });\n    },\n\n    //進去後傳房間給後端\n    enterMessage() {\n      this.socket.emit(\"join\", {\n        roomId: 1,\n      });\n    },\n\n    //通知哪位使用者上線(中間欄位)\n    NoticeUser() {\n      this.socket.on(\"active users\", (obj) => {\n        //console.log(\"obj\", obj);\n        this.usersCount = obj.userCount;\n        this.users = obj.activeUsers;\n        // console.log(\"message:\", this.users);\n      });\n    },\n\n    //訊息通知(在對話框加入訊息)\n    getMessage() {\n      this.socket.on(\"public chat\", (obj) => {\n        //console.log(\"msgobj\", obj);\n        //console.log(\"有沒有收到公開訊息\");\n           const newMessage = {\n          ...obj,\n          uuId: uuidv4(),\n        }\n        this.Messages.push(newMessage);\n        //this.handleScroll();\n        this.messageBottom = false;\n      });\n    },\n\n    //上下線通知(在對話框加入上下線通知)\n    message() {\n      this.socket.on(\"message\", (obj) => {\n        this.Messages.push(obj);\n        //this.handleScroll(); //滾輪\n        this.messageBottom = true;\n      });\n    },\n\n    //離開房間(離開房間訊息)\n    leaveRoom() {\n      if (this.roomId === 1) {\n        this.socket.emit(\"leave\", {\n          roomId: this.roomId,\n        });\n      } else {\n        return;\n      }\n    },\n\n    //後端確認收到訊息通知\n    // debugNotice() {\n    //   this.socket.on(\"debug notice\", (obj) => {\n    //     console.log(obj);\n    //   });\n    // },\n\n    //取得歷史訊息\n    async fetchMessage() {\n      try {\n        const response = await MessageAPI.getMessage({\n          roomId: this.roomId,\n        });\n        this.Messages = response.data.map((user) => ({\n          userId: user.User.id,\n          type: \"message\",\n          avatar: user.User.avatar,\n          createdAt: user.createdAt,\n          uuId: uuidv4(),\n          text: {\n            content: user.content,\n          },\n        }));\n\n        this.Messages.push(response.data);\n        //this.handleScroll(); //滾輪\n        this.messageBottom = false;\n      } catch (error) {\n        console.log(error);\n      }\n    },\n  },\n\n  //   computed: {\n  //   ...mapState([\"socket\"]),\n  // },\n\n  created() {\n    this.createdSocket();\n    this.enterMessage();\n  },\n\n  mounted() {\n   // this.debugNotice();\n    this.fetchMessage();\n    this.getMessage();\n    this.message();\n    this.NoticeUser();\n    \n  },\n\n  beforeDestroy() {\n    this.leaveRoom();\n  },\n\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"../assets/scss/colorAndSize.scss\";\n@import \"../assets/scss/efficientSetting.scss\";\n.public-message-content {\n  height: 100vh;\n  width: 100vw;\n  //標示用\n  // outline: red 2px solid;\n  .public-message {\n    @extend %views-grid;\n    grid-template-columns: 5fr 8fr 12.5fr;\n    //標示用\n    // outline: green 2px solid;\n    position: relative;\n  }\n}\n\n.public-users {\n  border-left: 1px solid #e6ecf0;\n  border-right: 1px solid #e6ecf0;\n  height: 100vh;\n  margin-left: 1.5em;\n  background-color: white;\n  z-index: 5;\n  //outline: black 1px solid;\n  overflow: scroll;\n  position: relative;\n  &::-webkit-scrollbar {\n    display: none;\n  }\n  &-title {\n    padding-left: 15px;\n    padding-top: 13px;\n    position: fixed;\n    width: 100%;\n    top: 0;\n    height: 55px;\n    border-bottom: $color-message-gray 1px solid;\n    h2 {\n      font-size: 18px;\n    }\n  }\n  &-content {\n    margin-top: 55px;\n\n    &-card {\n      align-items: center;\n      padding-left: 15px;\n      display: flex;\n      height: 75px;\n      border-bottom: $color-message-gray 1px solid;\n    }\n\n    &-img {\n      @extend %avatar-size;\n    }\n    &-text {\n      margin-left: 10px;\n      display: flex;\n      flex-direction: row;\n      &-name {\n        margin-right: 5px;\n        font-size: 15px;\n        color: $color-black;\n      }\n      &-account {\n        font-size: 15px;\n        color: $color-gray;\n      }\n    }\n  }\n}\n\n//手機板\n@media screen and (max-width: 768px) {\n  .public-message-content {\n    height: 100%;\n    h5 {\n      font-size: 15px;\n    }\n    .public-message {\n      grid-template-columns: 1fr;\n      grid-template-rows: 5fr 20fr;\n    }\n  }\n  .public-users {\n    border-bottom: $color-message-gray 2px solid;\n\n    z-index: 7;\n    width: 100%;\n    height: 120px;\n    position: fixed;\n    margin-left: 0em;\n    margin-top: 52px;\n    overflow-y: scroll;\n  }\n  .public-users-content {\n    margin-top: 55px;\n\n    display: flex;\n    &-text {\n      flex-direction: column;\n      &-account {\n        font-size: 13px;\n      }\n    }\n  }\n  .public-users-title {\n    display: none;\n  }\n}\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicMessage.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PublicMessage.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PublicMessage.vue?vue&type=template&id=717b4b3d&scoped=true&\"\nimport script from \"./PublicMessage.vue?vue&type=script&lang=js&\"\nexport * from \"./PublicMessage.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PublicMessage.vue?vue&type=style&index=0&id=717b4b3d&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"717b4b3d\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}